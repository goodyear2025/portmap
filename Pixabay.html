<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Pixabay 港写真ビューア</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    #results img { margin: 8px; max-width: 200px; border-radius: 8px; }
    .port-block { margin-bottom: 30px; }
    h3 { margin-bottom: 4px; }
  </style>
</head>
<body>
  <h2>Pixabay 港写真ビューア（自動クエリ生成）</h2>
  <button onclick="loadImagesForAllPorts()">すべての港で画像取得（テスト）</button>
  <div id="results"></div>

  <script>
    const API_KEY = "49630754-e3d9d976b8f5dd0d9d0e7da6a";

    const ports = [
      {
        Country: "Japan",
        Area: "Kagoshima",
        PortName: "Yakushima"
      },
      {
        Country: "Japan",
        Area: "Hokkaido",
        PortName: "Muroran"
      },
      {
        Country: "USA",
        Area: "Hawaii",
        PortName: "Honolulu"
      }
    ];

    function generatePixabayQuery(port) {
      const geo = [port.PortName, port.Area, port.Country]
        .filter(x => !!x && x !== '-' && x !== port.Country)
        .join(' ');
      const tags = ['landmark', 'tourism', 'world heritage'];
      return `${geo} ${tags.join(' ')}`;
    }

    async function loadImagesForAllPorts() {
      const container = document.getElementById("results");
      container.innerHTML = "";

      for (const port of ports) {
        const query = generatePixabayQuery(port);
        const res = await fetch(`https://pixabay.com/api/?key=${API_KEY}&q=${encodeURIComponent(query)}&image_type=photo&per_page=5&category=places&safesearch=true`);
        const data = await res.json();

        const block = document.createElement("div");
        block.className = "port-block";
        const title = document.createElement("h3");
        title.textContent = `${port.PortName} (${port.Area})`;
        block.appendChild(title);

        if (data.hits.length === 0) {
          block.appendChild(document.createTextNode("→ 関連写真が見つかりませんでした。"));
        } else {
          data.hits.forEach(img => {
            const imgElem = document.createElement("img");
            imgElem.src = img.webformatURL;
            imgElem.alt = img.tags;
            block.appendChild(imgElem);
          });
        }
        container.appendChild(block);
      }
    }
  </script>
</body>
</html>
