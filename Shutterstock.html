<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Shutterstock 港画像ビューア</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      background: #f9f9f9;
    }

    input, button {
      padding: 10px;
      font-size: 16px;
      margin-right: 8px;
    }

    .image-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      margin-top: 20px;
    }

    .image-grid img {
      width: 300px;
      height: 200px;
      object-fit: cover;
      border-radius: 8px;
      border: 1px solid #ccc;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .debug-log {
      background: #fff;
      padding: 10px;
      font-size: 14px;
      border: 1px solid #ccc;
      margin-top: 20px;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
  <h1>Shutterstock 港画像ビューア</h1>
  <input type="text" id="portInput" placeholder="Port name (e.g. Kagoshima)">
  <button onclick="searchImages()">Search Images</button>

  <div class="image-grid" id="imageContainer"></div>
  <div id="debugLog" class="debug-log"></div>

  <script>
    async function searchImages() {
      const query = document.getElementById('portInput').value.trim();
      const debugLog = document.getElementById('debugLog');
      const container = document.getElementById('imageContainer');
      debugLog.textContent = `🔍 Searching for: ${query}`;
      container.innerHTML = '';

      if (!query) {
        alert("Please enter a port name.");
        return;
      }

      try {
        const url = `https://auth-viewer.onrender.com/search?q=${encodeURIComponent(query)}`;
        debugLog.textContent += `\n➡️ Requesting: ${url}`;

        const response = await fetch(url);
        debugLog.textContent += `\n📥 Status: ${response.status} ${response.statusText}`;
        const rawText = await response.text();
        debugLog.textContent += `\n📝 Raw Response:\n${rawText}`;

        if (!response.ok) throw new Error("Fetch failed");

        const data = JSON.parse(rawText);
        const seenIds = new Set();

        data.forEach(img => {
          if (seenIds.has(img.id)) return;
          seenIds.add(img.id);
        
          const wrapper = document.createElement('div');
          wrapper.style.width = '300px';
          wrapper.style.display = 'inline-block';
          wrapper.style.margin = '8px';
          wrapper.style.verticalAlign = 'top';
          wrapper.style.fontSize = '13px';
        
          const imgElem = document.createElement('img');
          imgElem.src = img.url;
          imgElem.alt = img.description || '';
          imgElem.style.display = 'block';
          imgElem.style.width = '300px';
          imgElem.style.height = '200px';
          imgElem.style.objectFit = 'cover';
          imgElem.style.border = '1px solid #ccc';
          imgElem.style.borderRadius = '8px';
          imgElem.style.boxShadow = '0 2px 8px rgba(0,0,0,0.1)';
        
          const desc = document.createElement('div');
          desc.textContent = img.description || '(no description)';
          desc.style.marginTop = '6px';
          desc.style.fontWeight = 'bold';
        
          const keywords = document.createElement('div');
          keywords.textContent = img.keywords?.length ? `📌 ${img.keywords.join(', ')}` : '';
          keywords.style.fontSize = '12px';
          keywords.style.color = '#555';
        
          wrapper.appendChild(imgElem);
          wrapper.appendChild(desc);
          wrapper.appendChild(keywords);
          container.appendChild(wrapper);
        });

      } catch (err) {
        debugLog.textContent += `\n❌ Error: ${err.message}`;
        alert("画像取得に失敗しました");
        console.error(err);
      }
    }
  </script>
</body>
</html>
